<div class="page-title-box d-flex align-items-center justify-content-between mr-4 ml-4">
    <h4 class="mb-0">{{pageTitle}}</h4>
    <div class="page-title-right">
        <ol class="breadcrumb m-0" [hidden]="isChildRouteActive">
            <li class="breadcrumb-item"><a href="javascript: void(0);">Admin</a>
            </li>
            <li class="breadcrumb-item"><a routerLink="/applicant/ticket">Ticket</a>
            </li>
            <li class="breadcrumb-item active">{{breadcrumbTitle}}
            </li>
        </ol>
        <ol class="breadcrumb m-0" [hidden]="!isChildRouteActive">
            <li class="breadcrumb-item">
                <button (click)="back()" type="button" class="btn btn-light btn-sm">
                    <i class="  ri-arrow-left-line align-middle mr-2"></i>Back
                </button>
            </li>
        </ol>
    </div>
</div>
<div class="card" [hidden]="isChildRouteActive">
    <div class="card-body">
        <div class="col-lg-6">
            <form (ngSubmit)="submit()" [formGroup]="form" (keydown.enter)="$event.preventDefault()" autocomplete="off">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-label-group">
                            <input type="text" id="tt2" class="form-control" formControlName="ticketNo"
                                placeholder="Ticket No" disabled
                                [ngClass]="submitted && form.controls['ticketNo'].hasError('required')?'is-invalid':''" />
                            <label for="tt2">Ticket No<span class="text-danger">*</span></label>
                            <div class="invalid-feedback">
                                <span>This value is required.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-label-group">
                            <input type="date" disabled class="form-control" formControlName="date"
                                placeholder="Birth Date" />
                            <label>Ticket Date</label>
                        </div>
                    </div>
                    <div class="col-md-12" *ngIf="!isApplicationData">
                        <ng-template #name let-r="result" let-t="term">{{ r.fullName }} </ng-template>
                        <div class="form-label-group">
                            <input type="search" class="form-control col" [ngbTypeahead]="applicantSelectionFilter"
                                [resultTemplate]="name" [inputFormatter]="applicantSelectionFormatter"
                                formControlName="assignedToUserId" placeholder="Applicant" (clear)="onClear()"
                                [ngClass]="submitted && form.controls['assignedToUserId'].hasError('required')?'is-invalid':''" />
                            <label>Applicant<span class="text-danger">*</span></label>
                            <div class="invalid-feedback">
                                <span>This value is required.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-label-group">
                            <select name="ticketSubject" class="form-control" ng-disabled="isApplicationData"
                                formControlName="ticketSubject"
                                [ngClass]="submitted && form.controls['ticketSubject'].hasError('required')?'is-invalid':''">
                                <option value="">Select Subject</option>
                                <option *ngFor="let item of subjectList" [value]="item.id">
                                    {{ item.text }}
                                </option>
                            </select>
                            <label>Ticket Subject<span class="text-danger">*</span></label>
                            <div class="invalid-feedback">
                                <span>This value is required.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="form-label-group">
                            <textarea type="text" class="form-control" id="description" formControlName="description"
                                placeholder="Ship Address"
                                [ngClass]="submitted && form.controls['description'].hasError('required')?'is-invalid':''"></textarea>
                            <label for="description">Description<span class="text-danger">*</span></label>
                            <div class="invalid-feedback">
                                <span>This value is required.</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-sm mr-2 btn-sm">
                                <i class="ri-download-2-line align-middle mr-2"></i>
                                <ng-container *ngIf="issbtBtnLoading">
                                    <span class="indicator-progress" [style.display]="'block'">
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </ng-container>
                                <ng-container *ngIf="issbtBtnLoading ===false">
                                    <span class="indicator-label">Save</span>
                                </ng-container>
                            </button>
                            <button type="button" class="btn btn-light btn-sm" (click)="clear()">
                                <i class=" ri-eraser-line align-middle mr-2"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-lg-6"></div>
    </div>
</div>
<div class="card">
    <div class="card-body">
        <div class="row">
            <div class="col-sm-3">
                <ngb-alert [dismissible]="false" type="light">
                    <div class="custom-control custom-checkbox">
                        <input (change)="onTicketForChange(null,null)" type="checkbox" class="custom-control-input"
                            id="all" [checked]="isTicketForMe == null">
                        <label class="custom-control-label" for="all">All Tickets</label>
                    </div>
                </ngb-alert>
            </div>
            <div class="col-sm-3">
                <ngb-alert [dismissible]="false" type="success">
                    <div class="custom-control custom-checkbox">
                        <input (change)="onTicketForChange(true, null)" type="checkbox" class="custom-control-input"
                            id="forme" [checked]="isTicketForMe">
                        <label class="custom-control-label" for="forme">Tickets Raised By Me</label>
                    </div>
                </ngb-alert>
            </div>
            <div class="col-sm-3">
                <ngb-alert [dismissible]="false" type="warning">
                    <div class="custom-control custom-checkbox">
                        <input (change)="onTicketForChange(false,2)" type="checkbox" class="custom-control-input"
                            id="byme" [checked]="isTicketForMe === false && selectedStatus == 2">
                        <label class="custom-control-label" for="byme">Replied User Tickets</label>
                    </div>
                </ngb-alert>
            </div>
            <div class="col-sm-3">
                <ngb-alert [dismissible]="false" type="primary">
                    <div class="custom-control custom-checkbox">
                        <input (change)="onTicketForChange(false,1)" type="checkbox" class="custom-control-input"
                            id="byme1" [checked]="isTicketForMe === false && selectedStatus == 1">
                        <label class="custom-control-label" for="byme1">Pending User Tickets</label>
                    </div>
                </ngb-alert>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-sm table-bordered mb-0">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">Ticket No</th>
                        <th scope="col">Date</th>
                        <th scope="col">Name</th>
                        <th scope="col">Subject</th>
                        <th scope="colv">Application No</th>
                        <th scope="col">Description</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let rowData of filterLst; let i = index" [ngClass]="{'table_byme' : rowData.ownTicket , 'table_forme' : (!rowData.ownTicket && rowData.status == 2) 
                                    , 'table_forme_pending' : (!rowData.ownTicket && rowData.status == 1)}">
                        <td>{{rowData.ticketNo}}</td>
                        <td>{{rowData.date | date: 'dd/MM/yyyy hh:mm a'}}</td>
                        <td>{{rowData.creatorName}}</td>
                        <td>{{rowData.ticketSubjectText }}</td>
                        <td>{{rowData.applicationNo ? rowData.applicationNo : 'Not Selected'}}</td>
                        <td>{{rowData.description }}</td>
                        <td>
                            <div class="badge font-size-12"
                                [ngClass]="{'badge-soft-danger': rowData.status == 1,'badge-soft-success':rowData.status == 2}">
                                {{appCommon.EnTicketStatusTypeObj[rowData.status]}}
                            </div>
                            <small>
                                <p class="text-muted mb-0" *ngIf="rowData.replyerName">
                                    {{rowData.replyerName}}</p>
                            </small>
                        </td>
                        <td>
                            <a (click)="openPopup(rowData)" class="mr-3 text-primary pointer" ngbTooltip="View">
                                <i class="mdi mdi-eye font-size-18"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>